<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                 
<mapper namespace="com.humuson.push2u.push.dao.PushDao">

    <!-- 앱 유저 리스트 가져오기 -->
	<select id="getAppUserList" resultType="java.util.Map">
		SELECT CUST_ID, PHONE_NUM
		FROM APP_USERS;	    
	</select>
	
	<!-- MAX 캠페인 아이디 가져오기 -->
	<select id="getMaxCamId" resultType="int">
	    SELECT MAX(CAM_ID)
		FROM push_campaigns;
	</select>
	
	<!-- MAX 푸시 아이디 가져오기 -->
	<select id="getMaxPushId" resultType="int">
	    SELECT MAX(PUSH_ID)
		FROM push_detail;
	</select>
	
	<!-- 캠페인 정보 INSERT -->
	<insert id="insertCampaign" parameterType="java.util.Map">
	    INSERT INTO push_campaigns (USER_ID, MSG_TYPE, PUSH_TITLE, POPUP_CONTENT, PUSH_MSG, INAPP_CONTENT, REQ_DATE, SMS_YN, TARGET_CNT)
		VALUES (#{userId}, #{msgType}, #{pushTitle}, #{popupContents}, #{pushMsg}, #{inAppcontents}, SYSDATE(), #{smsYN}, #{targetCnt});
	</insert>
	
	<!-- 캠페인 디테일 insert -->
	<insert id="insertPushDetail">
	    INSERT INTO PUSH_DETAIL (CAM_ID, REQ_UID, CUST_ID, RTN_TYPE, RES_DATE)
		VALUES (#{camId}, #{reqUid}, #{custId}, 'N', DATE_FORMAT(SYSDATE(), '%Y%m%d%H%i%s'))
	</insert>
    
</mapper>